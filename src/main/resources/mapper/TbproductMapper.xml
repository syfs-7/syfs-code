<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zpark.mapper.TbproductMapper">
	<resultMap id="BaseResultMap" type="com.zpark.pojo.Tbproduct">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed May 08 
			10:45:33 CST 2019. -->
		<id column="id" jdbcType="INTEGER" property="id" />
		<result column="productname" jdbcType="VARCHAR"
			property="productname" />
		<result column="productsn" jdbcType="VARCHAR"
			property="productsn" />
		<result column="catalogid" jdbcType="INTEGER"
			property="catalogid" />
		<result column="brandid" jdbcType="INTEGER" property="brandid" />
		<result column="price" jdbcType="REAL" property="price" />
		<result column="saleamout" jdbcType="INTEGER"
			property="saleamout" />
		<result column="saleprice" jdbcType="REAL" property="saleprice" />
		<result column="serialno" jdbcType="INTEGER"
			property="serialno" />
		<result column="weight" jdbcType="REAL" property="weight" />
		<result column="productdesc" jdbcType="VARCHAR"
			property="productdesc" />
		<result column="productmark" jdbcType="VARCHAR"
			property="productmark" />
		<result column="amount" jdbcType="INTEGER" property="amount" />
		<result column="showflag" jdbcType="INTEGER"
			property="showflag" />
		<result column="payflag" jdbcType="INTEGER" property="payflag" />
		<result column="goodflag" jdbcType="INTEGER"
			property="goodflag" />
		<result column="picpath" jdbcType="VARCHAR" property="picpath" />
		<result column="productremark" jdbcType="LONGVARCHAR"
			property="productremark" />
	</resultMap>
	<delete id="deleteByPrimaryKey"
		parameterType="java.lang.Integer">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed May 08 
			10:45:33 CST 2019. -->
		delete from tbproduct
		where id = #{id,jdbcType=INTEGER}
	</delete>
	<insert id="insert" parameterType="com.zpark.pojo.Tbproduct">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed May 08 
			10:45:33 CST 2019. -->
		insert into tbproduct (id, productname, productsn,
		catalogid, brandid,
		price,
		saleamout, saleprice, serialno,
		weight, productdesc, productmark,
		amount, showflag, payflag,
		goodflag, picpath, productremark
		)
		values
		(#{id,jdbcType=INTEGER}, #{productname,jdbcType=VARCHAR},
		#{productsn,jdbcType=VARCHAR},
		#{catalogid,jdbcType=INTEGER},
		#{brandid,jdbcType=INTEGER}, #{price,jdbcType=REAL},
		#{saleamout,jdbcType=INTEGER}, #{saleprice,jdbcType=REAL},
		#{serialno,jdbcType=INTEGER},
		#{weight,jdbcType=REAL},
		#{productdesc,jdbcType=VARCHAR}, #{productmark,jdbcType=VARCHAR},
		#{amount,jdbcType=INTEGER}, #{showflag,jdbcType=INTEGER},
		#{payflag,jdbcType=INTEGER},
		#{goodflag,jdbcType=INTEGER},
		#{picpath,jdbcType=VARCHAR}, #{productremark,jdbcType=LONGVARCHAR}
		)
	</insert>
	<update id="updateByPrimaryKey"
		parameterType="com.zpark.pojo.Tbproduct">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed May 08 
			10:45:33 CST 2019. -->
		update tbproduct
		set productname = #{productname,jdbcType=VARCHAR},
		productsn = #{productsn,jdbcType=VARCHAR},
		catalogid =
		#{catalogid,jdbcType=INTEGER},
		brandid = #{brandid,jdbcType=INTEGER},
		price = #{price,jdbcType=REAL},
		saleamout =
		#{saleamout,jdbcType=INTEGER},
		saleprice = #{saleprice,jdbcType=REAL},
		serialno = #{serialno,jdbcType=INTEGER},
		weight =
		#{weight,jdbcType=REAL},
		productdesc = #{productdesc,jdbcType=VARCHAR},
		productmark = #{productmark,jdbcType=VARCHAR},
		amount =
		#{amount,jdbcType=INTEGER},
		showflag = #{showflag,jdbcType=INTEGER},
		payflag = #{payflag,jdbcType=INTEGER},
		goodflag =
		#{goodflag,jdbcType=INTEGER},
		picpath = #{picpath,jdbcType=VARCHAR},
		productremark = #{productremark,jdbcType=LONGVARCHAR}
		where id =
		#{id,jdbcType=INTEGER}
	</update>
	<select id="selectByPrimaryKey"
		parameterType="java.lang.Integer" resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed May 08 
			10:45:33 CST 2019. -->
		select id, productname, productsn, catalogid, brandid, price,
		saleamout, saleprice,
		serialno, weight, productdesc, productmark,
		amount, showflag, payflag,
		goodflag,
		picpath, productremark
		from
		tbproduct
		where id = #{id,jdbcType=INTEGER}
	</select>
	<select id="selectAll" resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed May 08 
			10:45:33 CST 2019. -->
		select id, productname, productsn, catalogid, brandid, price,
		saleamout, saleprice,
		serialno, weight, productdesc, productmark,
		amount, showflag, payflag,
		goodflag,
		picpath, productremark
		from
		tbproduct
	</select>

	<!-- 查询出来的内容要和TbproductResultMap中一一对应 -->
	<select id="findTbproductAndTbcatalog"
		parameterType="com.zpark.pojo.Tbproduct"
		resultMap="TbproductResultMap">
		SELECT
		p.id,p.productname,p.productsn,p.catalogid,p.brandid,p.price,p.saleamout,p.saleprice,p.serialno,p.weight,p.productdesc,p.productmark,p.amount,p.showflag,p.payflag,p.goodflag,p.picpath,p.productremark,c.id,c.catalog,c.catalogdesc,c.showflag,c.goodflag,c.serialno,c.parentid
		FROM tbproduct p JOIN tbcatalog c on p.catalogid=c.id
		<include refid="selectTbproductAndTbcatalog"></include>
	</select>

	<sql id="selectTbproductAndTbcatalog">
		<where>
			<if test="productname!=null and productname!=''">
				and productname like #{productname}
			</if>
			<if test="catalogid != -1">
				and c.id = #{catalogid}
			</if>
		</where>
	</sql>

	<resultMap type="com.zpark.pojo.Tbproduct"
		id="TbproductResultMap">

		<id column="id" jdbcType="INTEGER" property="id" />
		<result column="productname" jdbcType="VARCHAR"
			property="productname" />
		<result column="productsn" jdbcType="VARCHAR"
			property="productsn" />
		<result column="catalogid" jdbcType="INTEGER"
			property="catalogid" />
		<result column="brandid" jdbcType="INTEGER" property="brandid" />
		<result column="price" jdbcType="REAL" property="price" />
		<result column="saleamout" jdbcType="INTEGER"
			property="saleamout" />
		<result column="saleprice" jdbcType="REAL" property="saleprice" />
		<result column="serialno" jdbcType="INTEGER"
			property="serialno" />
		<result column="weight" jdbcType="REAL" property="weight" />
		<result column="productdesc" jdbcType="VARCHAR"
			property="productdesc" />
		<result column="productmark" jdbcType="VARCHAR"
			property="productmark" />
		<result column="amount" jdbcType="INTEGER" property="amount" />
		<result column="showflag" jdbcType="INTEGER"
			property="showflag" />
		<result column="payflag" jdbcType="INTEGER" property="payflag" />
		<result column="goodflag" jdbcType="INTEGER"
			property="goodflag" />
		<result column="picpath" jdbcType="VARCHAR" property="picpath" />
		<result column="productremark" jdbcType="LONGVARCHAR"
			property="productremark" />

		<association property="tbcatalog" javaType="Tbcatalog">
			<id column="id" jdbcType="INTEGER" property="id" />
			<result column="catalog" jdbcType="VARCHAR" property="catalog" />
			<result column="catalogdesc" jdbcType="VARCHAR"
				property="catalogdesc" />
			<result column="showflag" jdbcType="INTEGER"
				property="showflag" />
			<result column="goodflag" jdbcType="INTEGER"
				property="goodflag" />
			<result column="serialno" jdbcType="INTEGER"
				property="serialno" />
			<result column="parentid" jdbcType="INTEGER"
				property="parentid" />
		</association>

	</resultMap>

	<!-- 三表联查 -->
	<select id="selectProductByColumns"
		parameterType="com.zpark.pojo.ProductVO" resultMap="productResultMap">
		select pt.id
		ptid,pt.picpath,pt.productname,pt.productsn,pt.catalogid,pt.brandid,bd.brandname,pt.price,pt.showflag,pt.goodflag,pt.amount
		from tbproduct pt JOIN tbbrand bd ON pt.brandid = bd.brandid
		<include refid="productColumns"></include>
		order by pt.id desc
	</select>
	
	<!-- 一对一	一个对象	包含在另一个对象里面	支持懒加载
		 vo视图对象	不支持懒加载
	 -->

	<sql id="productColumns">
		<where>
			<if test="productname!=null and productname!=''">
				and pt.productname like #{productname}
			</if>
			<if test="catalogid!=-1">
				and pt.catalogid = #{catalogid}
			</if>

			<if test="brandid!=-1">
				and pt.brandid = #{brandid}
			</if>
			<if test="showflag!=-1">
				and pt.showflag = #{showflag}
			</if>
			<if test="lowprice!=0">
				and pt.price >= #{lowprice}
			</if>
			<if test="upprice!=0">
				and pt.price &lt;= #{upprice}
			</if>
			<!-- mybatis小于符号需要转义 -->
			<if test="goodflag!=-1">
				and pt.goodflag = #{goodflag}
			</if>
		</where>
	</sql>

	<resultMap id="productResultMap"
		type="com.zpark.pojo.ProductVO">
		<!-- 每个字段的顺序和ProductVO中一致
			 column为selectProductByColumns中的字段
			 多表联查主要字段名是否重复
		 -->
		<id column="ptid" jdbcType="INTEGER" property="id" />
		<result column="picpath" jdbcType="VARCHAR" property="picpath" />
		<result column="productname" jdbcType="VARCHAR"
			property="productname" />
		<result column="productsn" jdbcType="VARCHAR"
			property="productsn" />
		<result column="catalogid" jdbcType="INTEGER"
			property="catalogid" />
		<result column="brandid" jdbcType="INTEGER" property="brandid" />
		<result column="brandname" jdbcType="INTEGER"
			property="brandname" />
		<result column="price" jdbcType="DOUBLE" property="price" />
		<result column="amount" jdbcType="INTEGER" property="amount" />
		<result column="showflag" jdbcType="INTEGER"
			property="showflag" />
		<result column="goodflag" jdbcType="INTEGER"
			property="goodflag" />
	</resultMap>

</mapper>